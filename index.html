<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Vyhled√°vaƒç spojen√≠ Somewhere</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background-color: #fafafa; }
        h1 { color: #2c3e50; }
        input, button { padding: 12px; margin: 5px 0; font-size: 16px; }
        button { background-color: #27ae60; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #219150; }
        .result { background: white; padding: 15px; margin: 15px 0; border-left: 5px solid #27ae60; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .delay { color: red; font-weight: bold; }
        .on-time { color: green; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>üöÖ Vyhled√°n√≠ spojen√≠</h1>
    <div style="background: #eee; padding: 20px; border-radius: 8px;">
        <input type="text" id="from" value="Praha" placeholder="Odkud (p≈ôesn√Ω n√°zev stanice)">
        <input type="text" id="to" value="Brno" placeholder="Kam (p≈ôesn√Ω n√°zev stanice)">
        <button onclick="search()">Vyhledat spojen√≠</button>
    </div>
    
    <div id="results"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- TVOJE NASTAVEN√ç (Vlo≈æeno) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBK6Nov1Csfxr2O7iE2WZoKNchmGVFdbHg",
            authDomain: "somewherevyhledavac.firebaseapp.com",
            databaseURL: "https://somewherevyhledavac-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "somewherevyhledavac",
            storageBucket: "somewherevyhledavac.firebasestorage.app",
            messagingSenderId: "115280119429",
            appId: "1:115280119429:web:20c50edc0b0bd680e9cbec",
            measurementId: "G-ZW5WT8D9YW"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.search = async () => {
            const from = document.getElementById('from').value.trim();
            const to = document.getElementById('to').value.trim();
            const div = document.getElementById('results');
            div.innerHTML = "Naƒç√≠t√°m data...";

            try {
                const res = await fetch('spoje.json');
                const trains = await res.json();
                div.innerHTML = "";
                let foundAny = false;

                for (const t of trains) {
                    const idxA = t.trasa.findIndex(s => s.stanice === from);
                    const idxB = t.trasa.findIndex(s => s.stanice === to);

                    // Pokud vlak jede z A do B (a stanice existuj√≠ ve spr√°vn√©m po≈ôad√≠)
                    if (idxA !== -1 && idxB !== -1 && idxA < idxB) {
                        foundAny = true;
                        
                        // Zjistit zpo≈ædƒõn√≠ ve v√Ωchoz√≠ stanici (nebo v posledn√≠ hl√°≈°en√©)
                        // Pro zjednodu≈°en√≠ bereme zpo≈ædƒõn√≠ hl√°≈°en√© ve stanici "Odkud"
                        const delaySnap = await get(ref(db, `zpozdeni/${from}/${t.id}`));
                        const delay = delaySnap.val() || 0;
                        
                        let delayText = '<span class="on-time">Jede vƒças</span>';
                        let delayClass = "";
                        
                        if (delay > 0) {
                            delayText = `<span class="delay">(+${delay} min zpo≈ædƒõn√≠)</span>`;
                            delayClass = "border-left-color: red;"; 
                        }

                        // V√Ωpoƒçet ƒçasu p≈ô√≠jezdu (jen orientaƒçn√≠ text, nepoƒç√≠t√° zpo≈ædƒõn√≠ do ƒçasu)
                        div.innerHTML += `
                            <div class="result" style="${delay > 0 ? 'border-left-color: red;' : ''}">
                                <h3>${t.nazev}</h3>
                                <p>
                                    Odjezd z <strong>${from}</strong>: ${t.trasa[idxA].cas} ${delayText}<br>
                                    P≈ô√≠jezd do <strong>${to}</strong>: ${t.trasa[idxB].cas}
                                </p>
                            </div>
                        `;
                    }
                }
                
                if (!foundAny) {
                    div.innerHTML = "<p>≈Ω√°dn√© p≈ô√≠m√© spojen√≠ nenalezeno. Zkontroluj n√°zvy stanic.</p>";
                }

            } catch (e) {
                div.innerHTML = "Chyba: Nepoda≈ôilo se naƒç√≠st j√≠zdn√≠ ≈ô√°dy (spoje.json).";
                console.error(e);
            }
        };
    </script>
</body>
</html>